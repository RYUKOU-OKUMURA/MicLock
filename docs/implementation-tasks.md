# MicLock 実装タスクリスト

## プロジェクト概要
- **対象プラットフォーム**: macOS（最新安定版）
- **対象ユーザー**: 会議/配信時に安定したマイク音量が必要な非エンジニア
- **アーキテクチャ**: Clean Architecture + SwiftUI
- **主要インターフェース**: MenuBarExtra（Dockアイコンなし）

---

## Phase 1: MVP基盤構築（2-4日）

### 1.1 プロジェクトセットアップと設定

#### 1.1.1 Xcodeプロジェクト作成
- [ ] Xcodeで新しいmacOSアプリプロジェクトを作成する
- [ ] SwiftUIをインターフェースとして使用する
- [ ] 最小デプロイターゲットを設定する（macOS 14.0+）
- [ ] バンドルIDを設定する（例: com.miclock.app）
- [ ] アプリ名と表示名を設定する
- **完了条件**: プロジェクトがビルドされ、空白ウィンドウで実行できる
- **依存関係**: なし
- **見積もり**: 30分

#### 1.1.2 MenuBarExtraの設定
- [ ] App構造体からデフォルトのWindowGroupを削除する
- [ ] App構造体にMenuBarExtraを追加する
- [ ] プレースホルダーメニューコンテンツを作成する
- [ ] メニューバーアイコンが表示されることを確認する
- **完了条件**: メニューバーアイコンが基本メニューで表示される
- **依存関係**: 1.1.1
- **見積もり**: 30分

#### 1.1.3 プロジェクト構造のセットアップ
- [ ] Clean Architectureに従ってフォルダ構造を作成する:
  - `Presentation/`
  - `Application/`
  - `Domain/`
  - `Infrastructure/`
- [ ] 各コンポーネントのプレースホルダーファイルを作成する
- [ ] 视覚的な整理のためにXcodeグループを設定する
- **完了条件**: すべてのフォルダがプレースホルダーファイルで存在する
- **依存関係**: 1.1.1
- **見積もり**: 20分

#### 1.1.4 テストインフラストラクチャ
- [ ] ユニットテストターゲット構造を作成する
- [ ] メインターゲットに一致するテスト編成を設定する
- [ ] 基本的なプレースホルダーテストを追加する
- **完了条件**: テストを実行できる（空でも可）
- **依存関係**: 1.1.3
- **見積もり**: 20分

---

### 1.2 Infrastructure Layer - CoreAudio統合

#### 1.2.1 AudioDeviceRepository - デバイス検出
- [ ] `AudioDeviceRepository`クラスを作成する
- [ ] `getDefaultInputDevice()`メソッドを実装する
  - `AudioHardwareGetProperty`を`kAudioHardwarePropertyDefaultInputDevice`と共に使用
- [ ] CoreAudio API呼び出しのエラーハンドリングを追加する
- [ ] `AudioDeviceID`またはnilを返す
- **完了条件**: デフォルト入力デバイスIDを取得できる
- **依存関係**: 1.1.3
- **見積もり**: 1時間

#### 1.2.2 AudioDeviceRepository - デバイス名
- [ ] `getDeviceName(_ deviceID: AudioDeviceID)`メソッドを実装する
  - `AudioObjectGetPropertyData`を`kAudioDevicePropertyDeviceNameCFString`と共に使用
- [ ] CFStringからSwift Stringへの変換を処理する
- [ ] エラーハンドリングを追加する
- **完了条件**: 表示用のデバイス名を取得できる
- **依存関係**: 1.2.1
- **見積もり**: 45分

#### 1.2.3 AudioDeviceRepository - 音量読み取り
- [ ] `getVolume(_ deviceID: AudioDeviceID)`メソッドを実装する
  - 最初にマスターチャンネルを試す（`kAudioHardwareServiceDeviceProperty_VirtualMasterVolume`）
  - チャンネル0にフォールバック（`kAudioDevicePropertyVolumeScalar`）
- [ ] Float（0.0〜1.0）またはnilを返す
- [ ] エラーロギングを追加する
- **完了条件**: 現在の音量レベルを読み取れる
- **依存関係**: 1.2.1
- **見積もり**: 1時間

#### 1.2.4 AudioDeviceRepository - 音量書き込み
- [ ] `setVolume(_ volume: Float, deviceID: AudioDeviceID)`メソッドを実装する
  - 最初にマスターチャンネルを試す
  - チャンネル0にフォールバック
- [ ] 音量範囲の検証（0.0-1.0にクランプ）
- [ ] エラーハンドリングとロギングを追加する
- **完了条件**: 音量を正常に設定できる
- **依存関係**: 1.2.3
- **見積もり**: 1時間

#### 1.2.5 AudioDeviceRepository - 能力チェック
- [ ] `canSetVolume(_ deviceID: AudioDeviceID)`メソッドを実装する
  - 音量プロパティが設定可能かどうかを確認
- [ ] デバイスサポートを示すBoolを返す
- **完了条件**: デバイスが音量制御をサポートしているか判断できる
- **依存関係**: 1.2.4
- **見積もり**: 30分

#### 1.2.6 DeviceObserver - イベントリスナー設定
- [ ] `DeviceObserver`クラスを作成する
- [ ] `startListening(onChange: @escaping () -> Void)`メソッドを実装する
  - `AudioObjectAddPropertyListenerBlock`を使用
  - `kAudioHardwarePropertyDefaultInputDevice`のリスナーを登録
  - 現在のデバイスの音量変更を登録
- [ ] プロパティ変更用のコールバックを保存する
- **完了条件**: デバイス/音量変更のリスナーが登録される
- **依存関係**: 1.2.1
- **見積もり**: 1.5時間

#### 1.2.7 DeviceObserver - イベントリスナークリーンアップ
- [ ] `stopListening()`メソッドを実装する
  - `AudioObjectRemovePropertyListener`でプロパティリスナーを削除
- [ ] deinit時の適切なクリーンアップを保証する
- **完了条件**: リスナーが適切に削除される
- **依存関係**: 1.2.6
- **見積もり**: 45分

#### 1.2.8 PollingGuard - 実装
- [ ] `PollingGuard`クラスを作成する
- [ ] `start(interval: TimeInterval, check: @escaping () -> Void)`メソッドを実装する
  - `Timer`または`asyncAfter`ループを使用
- [ ] `stop()`メソッドを実装する
- [ ] 間隔の検証を追加する
- **完了条件**: 定期チェックが指定された間隔で実行される
- **依存関係**: なし
- **見積もり**: 45分

#### 1.2.9 ConfigStore - UserDefaultsラッパー
- [ ] `ConfigStore`クラスを作成する
- [ ] 以下のプロパティで`AppSettings`構造体を定義する:
  - `isLockEnabled: Bool`
  - `targetVolume: Float`（デフォルト0.8）
  - `pollingIntervalSec: Double`（デフォルト0.5）
  - `epsilon: Float`
  - `launchAtLogin: Bool`
- [ ] `save(settings: AppSettings)`メソッドを実装する
- [ ] `loadSettings() -> AppSettings`メソッドを実装する
- [ ] すべてのプロパティのデフォルト値を追加する
- **完了条件**: 設定がアプリ起動間で永続化される
- **依存関係**: 1.1.3
- **見積もり**: 1時間

#### 1.2.10 DiagnosticsLogger - 構造化ロギング
- [ ] `OSLog`を使用する`DiagnosticsLogger`クラスを作成する
- [ ] ログカテゴリを実装する:
  - 一般操作用の`.info`
  - 失敗用の`.error`
  - 詳細なトラブルシューティング用の`.debug`
- [ ] 構造化メタデータサポートを追加する
- [ ] ログエクスポートメソッドを作成する（ユーザーサポート用）
- **完了条件**: ログがキャプチャされ、エクスポートできる
- **依存関係**: なし
- **見積もり**: 45分

#### 1.2.11 LaunchAtLoginManager - SMAppService
- [ ] `LaunchAtLoginManager`クラスを作成する
- [ ] `isEnabled() -> Bool`メソッドを実装する
  - `SMAppService.mainApp.status`を使用
- [ ] `setEnabled(_ enabled: Bool)`メソッドを実装する
  - `SMAppService.mainApp.register()` / `unregister()`を使用
- [ ] エラーを適切に処理する
- **完了条件**: ログイン時起動設定を切り替えられる
- **依存関係**: なし
- **見積もり**: 1時間

---

### 1.3 Domain Layer

#### 1.3.1 EngineState列挙型
- [ ] `EngineState`列挙型を作成する:
  - `Idle` - 監視していない
  - `Monitoring` - 音量をアクティブに監視中
  - `Correcting` - 補正を適用中
  - `Unsupported` - デバイスが音量制御をサポートしていない
  - `Error` - エラーが発生
- [ ] 表示名用の計算プロパティを追加する
- **完了条件**: すべての状態がユーザーフレンドリーな名前で定義されている
- **依存関係**: なし
- **見積もり**: 20分

#### 1.3.2 RuntimeStatusモデル
- [ ] `RuntimeStatus`構造体を作成する:
  - `activeDeviceID: AudioDeviceID?`
  - `activeDeviceName: String?`
  - `state: EngineState`
  - `lastErrorCode: String?`
  - `lastErrorMessage: String?`
  - `lastCorrectionAt: Date?`
- [ ] `reset()`メソッドを追加する
- **完了条件**: ランタイムステータスモデルの準備完了
- **依存関係**: 1.3.1
- **見積もり**: 30分

#### 1.3.3 VolumeDriftDetector
- [ ] `VolumeDriftDetector`クラス/コンポーネントを作成する
- [ ] `shouldCorrect(current: Float, target: Float, epsilon: Float) -> Bool`を実装する
  - `abs(current - target) > epsilon`を返す
- [ ] エッジケースのテストを追加する（等しい値、イプシロン閾値）
- **完了条件**: 音量補正が必要なときを正しく検出する
- **依存関係**: なし
- **見積もり**: 30分

#### 1.3.4 エラー分類
- [ ] `MicLockError`列挙型を定義する:
  - `deviceNotSupported`
  - `permissionDenied`
  - `deviceDisconnected`
  - `unknown(Error)`
- [ ] 各エラータイプのユーザーフレンドリーなメッセージを追加する
- [ ] `isRecoverable: Bool`プロパティを追加する
- **完了条件**: すべてのエラータイプが回復情報と共に定義されている
- **依存関係**: なし
- **見積もり**: 30分

---

### 1.4 Application Layer

#### 1.4.1 MicLockEngine - 状態管理
- [ ] `MicLockEngine`クラスを作成する
- [ ] 以下の`@Published`プロパティを追加する:
  - `runtimeStatus: RuntimeStatus`
  - `appSettings: AppSettings`
- [ ] すべてのインフラストラクチャ依存関係を初期化する
- [ ] 初期状態を`.Idle`に設定する
- **完了条件**: エンジンが状態変更を公開する
- **依存関係**: 1.2.9, 1.3.2
- **見積もり**: 45分

#### 1.4.2 MicLockEngine - 監視開始
- [ ] `startMonitoring()`メソッドを実装する
  - デバイスが音量制御をサポートしているか確認
  - 状態を`.Monitoring`または`.Unsupported`に設定
  - DeviceObserverを開始
  - PollingGuardを開始
  - 初期デバイス情報を取得
- [ ] 非対応デバイスを処理する
- **完了条件**: 監視が正常に開始されるか、非対応状態が表示される
- **依存関係**: 1.2.6, 1.2.8, 1.2.5, 1.4.1
- **見積もり**: 1.5時間

#### 1.4.3 MicLockEngine - 監視停止
- [ ] `stopMonitoring()`メソッドを実装する
  - DeviceObserverを停止
  - PollingGuardを停止
  - 状態を`.Idle`に設定
  - ランタイムステータスをクリア
- **完了条件**: 監視が正常に停止する
- **依存関係**: 1.4.2
- **見積もり**: 45分

#### 1.4.4 MicLockEngine - 音量チェック
- [ ] `checkAndCorrectVolume()`メソッドを実装する
  - リポジトリから現在の音量を取得
  - VolumeDriftDetectorを使用してドリフトを確認
  - ドリフトが検出された場合、補正をトリガー
- [ ] lastCorrectionAtタイムスタンプを更新する
- **完了条件**: 音量がチェックされ、必要に応じて補正される
- **依存関係**: 1.2.3, 1.3.3, 1.4.2
- **見積もり**: 1時間

#### 1.4.5 MicLockEngine - 補正ロジック
- [ ] `applyCorrection()`メソッドを実装する
  - 状態を`.Correcting`に設定
  - 目標音量をデバイスに書き込む
  - 補正が適用されたことを確認
  - `.Monitoring`状態に戻る
- [ ] 補正失敗を処理する
- **完了条件**: 音量が正常に補正される
- **依存関係**: 1.2.4, 1.4.4
- **見積もり**: 1時間

#### 1.4.6 MicLockEngine - イベント処理
- [ ] DeviceObserverコールバックを接続する
  - デバイス変更時: 監視を再初期化
  - 音量変更時: チェックをトリガー
- [ ] PollingGuardコールバックを接続する
  - 定期音量チェック
- **完了条件**: 両方の監視メカニズムがチェックをトリガーする
- **依存関係**: 1.4.4, 1.2.6, 1.2.8
- **見積もり**: 1時間

#### 1.4.7 MicLockEngine - エラーハンドリング
- [ ] すべての操作にエラーハンドリングを追加する
  - MicLockErrorを使用してエラーを分類
  - エラー情報でruntimeStatusを更新
  - 致命的エラー時に状態を`.Error`に設定
  - DiagnosticsLoggerでエラーをログ記録
- **完了条件**: すべてのエラーが適切に処理され、ログ記録される
- **依存関係**: 1.3.4, 1.2.10, 1.4.6
- **見積もり**: 1.5時間

---

### 1.5 Presentation Layer

#### 1.5.1 MenuBarController - 基本レイアウト
- [ ] `MenuBarController` SwiftUIビューを作成する
- [ ] メニュー構造を定義する:
  - アイコン/ステータスインジケーター
  - ロックトグル（ON/OFF）
  - 現在のデバイス名
  - 現在の状態表示
  - セパレーター
  - 設定ボタン
  - 終了ボタン
- **完了条件**: メニュー構造が表示される
- **依存関係**: 1.1.2
- **見積もり**: 45分

#### 1.5.2 MenuBarController - 状態表示
- [ ] MicLockEngineの公開プロパティに接続する
- [ ] 現在の状態を表示する（Idle、Monitoring、Correctingなど）
- [ ] アクティブデバイス名を表示する
- [ ] ロックステータスの視覚インジケーター（アイコン色）を追加する
- **完了条件**: メニューにリアルタイム状態更新が表示される
- **依存関係**: 1.5.1, 1.4.1
- **見積もり**: 1時間

#### 1.5.3 MenuBarController - ロックトグル
- [ ] ロックON/OFFボタンを実装する
  - `startMonitoring()` / `stopMonitoring()`を呼び出す
  - 確認を表示する
  - エラーを処理する
- [ ] 状態に基づいてボタンの外観を更新する
- **完了条件**: トグルが監視を開始/停止する
- **依存関係**: 1.5.2, 1.4.2, 1.4.3
- **見積もり**: 45分

#### 1.5.4 MenuBarController - 音量クイック表示
- [ ] メニューに現在の音量パーセンテージを表示する
- [ ] 目標音量パーセンテージを表示する
- [ ] 音量変更時に更新する
- **完了条件**: 現在の音量と目標音量が表示される
- **依存関係**: 1.5.2, 1.2.3
- **見積もり**: 30分

#### 1.5.5 SettingsViewModel - 基本セットアップ
- [ ] `SettingsViewModel`クラスを作成する（ObservableObject）
- [ ] ConfigStoreに接続する
  - 初期設定をロード
  - 変更を保存
- [ ] 設定値の検証を追加する
- **完了条件**: 設定がロードされ、永続化される
- **依存関係**: 1.2.9
- **見積もり**: 45分

#### 1.5.6 SettingsView - レイアウト
- [ ] `SettingsView` SwiftUIビューを作成する
- [ ] セクションを追加する:
  - 目標音量（スライダー）
  - 許容差（epsilon）（スライダー）
  - ポーリング間隔（スライダー）
  - ログイン時起動（トグル）
- [ ] 保存/キャンセルボタンを追加する
- **完了条件**: 設定UIが表示される
- **依存関係**: 1.5.5
- **見積もり**: 1時間

#### 1.5.7 SettingsView - 音量コントロール
- [ ] 目標音量スライダーを実装する
  - 範囲: 0.0 から 1.0
  - ステップ: 0.05
  - パーセンテージラベルを表示
- [ ] ViewModelに接続する
- [ ] 範囲を検証する
- **完了条件**: 目標音量を調整できる
- **依存関係**: 1.5.6
- **見積もり**: 30分

#### 1.5.8 SettingsView - イプシロンコントロール
- [ ] イプシロン（許容差）スライダーを実装する
  - 範囲: 0.01 から 0.1
  - ステップ: 0.01
  - 説明文を表示
- [ ] ViewModelに接続する
- **完了条件**: 許容差閾値を調整できる
- **依存関係**: 1.5.6
- **見積もり**: 30分

#### 1.5.9 SettingsView - ポーリング間隔コントロール
- [ ] ポーリング間隔スライダーを実装する
  - 範囲: 0.1 から 2.0秒
  - ステップ: 0.1
  - 説明文を表示
- [ ] ViewModelに接続する
- **完了条件**: ポーリング頻度を調整できる
- **依存関係**: 1.5.6
- **見積もり**: 30分

#### 1.5.10 SettingsView - ログイン時起動
- [ ] ログイン時起動トグルを実装する
- [ ] LaunchAtLoginManagerに接続する
- [ ] 外部で変更されたときにトグル状態を更新する
- **完了条件**: ログイン時起動を切り替えられる
- **依存関係**: 1.5.6, 1.2.11
- **見積もり**: 30分

#### 1.5.11 SettingsView - 統合
- [ ] MenuBarControllerにSettingsViewを統合する
  - シートまたはポップオーバーとして表示
  - 無視を処理
- [ ] エンジンが設定変更を受け取るようにする
- **完了条件**: 設定にメニューバーからアクセスできる
- **依存関係**: 1.5.1, 1.5.6
- **見積もり**: 30分

---

### 1.6 統合とテスト

#### 1.6.1 エンドツーエンド統合
- [ ] すべてのコンポーネントを接続する
  - AppがMicLockEngineをインスタンス化
  - MenuBarControllerがエンジンを監視
  - SettingsViewがConfigStoreを更新
- [ ] 完全なフローをテストする: 起動 → ロック有効化 → 音量ドリフト → 補正
- **完了条件**: 完全なフローがクラッシュなしで動作する
- **依存関係**: Phase 1のすべての以前のタスク
- **見積もり**: 1.5時間

#### 1.6.2 手動テスト - 基本シナリオ
- [ ] テスト: アプリを起動（Idleであるべき）
- [ ] テスト: ロックを有効化（Monitoringになるべき）
- [ ] テスト: 外部で音量を変更（元に戻るべき）
- [ ] テスト: ロックを無効化（Idleになるべき）
- [ ] テスト: 目標音量を変更（新しい値を使用すべき）
- [ ] テスト: 終了して再起動（設定が永続化されている）
- **完了条件**: すべての基本シナリオがパスする
- **依存関係**: 1.6.1
- **見積もり**: 1時間

#### 1.6.3 手動テスト - エッジケース
- [ ] テスト: 現在のオーディオデバイスを切断
- [ ] テスト: 非対応デバイスに切り替え
- [ ] テスト: 非常に低いイプシロン（0.01）
- [ ] テスト: 非常に高いイプシロン（0.1）
- [ ] テスト: 高速オン/オフトグル
- **完了条件**: すべてのエッジケースが適切に処理される
- **依存関係**: 1.6.2
- **見積もり**: 1.5時間

#### 1.6.4 ユニットテスト - コアロジック
- [ ] VolumeDriftDetectorのテストを追加
- [ ] MicLockError分類のテストを追加
- [ ] AppSettingsデフォルトのテストを追加
- [ ] RuntimeStatusモデルのテストを追加
- **完了条件**: コアロジックが80%以上のカバレッジを持つ
- **依存関係**: 1.1.4
- **見積もり**: 1.5時間

---

## Phase 2: 運用強化（2-3日）

### 2.1 エラーハンドリングとユーザー体験

#### 2.1.1 エラーメッセージのローカライゼーション
- [ ] 各エラータイプのユーザーフレンドリーなメッセージを作成する
  - デバイス非対応: 「このデバイスは音量制御をサポートしていません。別のマイクをお試しください。」
  - 権限拒否: 「マイクアクセスが必要です。システム設定 > プライバシーとセキュリティを確認してください。」
  - デバイス切断: 「マイクが切断されました。再接続して再試行してください。」
  - 不明: 「問題が発生しました。詳細は診断情報を確認してください。」
- [ ] 日本語訳を追加する（推奨）
- **完了条件**: すべてのエラーに明確なユーザーメッセージがある
- **依存関係**: Phase 1完了
- **見積もり**: 1時間

#### 2.1.2 エラー通知システム
- [ ] `ErrorNotificationManager`クラスを作成する
- [ ] デバウンシングを実装する（同じエラーをスパムしない）
- [ ] 一時的な失敗のエラー抑制を実装する
- [ ] 通知無視処理を追加する
- **完了条件**: エラーがユーザーにスパムせずに表示される
- **依存関係**: 2.1.1
- **見積もり**: 1.5時間

#### 2.1.3 診断エクスポート機能
- [ ] DiagnosticsLoggerで診断エクスポートを実装する
  - 最近のログを含む
  - 現在の設定を含む
  - ランタイムステータスを含む
  - システム情報（macOSバージョン、デバイスモデル）を含む
- [ ] メニューに「診断情報をコピー」ボタンを追加する
- [ ] サポートリクエスト用の出力をフォーマットする
- **完了条件**: ユーザーが診断情報をコピーできる
- **依存関係**: 1.2.10
- **見積もり**: 1.5時間

#### 2.1.4 リトライポリシーの実装
- [ ] リトライ戦略を定義する:
  - 回復可能エラー: 5秒後にリトライ
  - 最大3回のリトライ
  - 持続的エラーの指数バックオフ
- [ ] MicLockEngineで実装する
- [ ] RuntimeStatusにリトライカウントを追加する
- **完了条件**: 失敗した操作が適切にリトライされる
- **依存関係**: 1.4.7
- **見積もり**: 1.5時間

---

### 2.2 一時停止機能

#### 2.2.1 一時停止データモデル
- [ ] AppSettingsに`pauseUntil: Date?`を追加する
- [ ] `isPaused: Bool`計算プロパティを追加する
- [ ] 一時停止状態を処理するようにConfigStoreを更新する
- **完了条件**: 一時停止状態がアプリ起動間で永続化される
- **依存関係**: 1.2.9
- **見積もり**: 30分

#### 2.2.2 一時停止UI
- [ ] MenuBarControllerに「一時停止...」サブメニューを追加する
  - 5分
  - 15分
  - 30分
  - 1時間
  - 再開ボタン（一時停止中）
- [ ] メニューに一時停止インジケーターを表示する
- **完了条件**: ユーザーが監視を一時停止できる
- **依存関係**: 2.2.1, 1.5.3
- **見積もり**: 1時間

#### 2.2.3 一時停止ロジック
- [ ] MicLockEngineで一時停止処理を実装する
  - 一時停止中は音量チェックをスキップ
  - UIに一時停止状態を表示
  - 一時停止期限切れ時に自動的に再開
- [ ] 一時停止期限切れ用のタイマーを追加する
- **完了条件**: 一時停止が監視を正しく中断する
- **依存関係**: 2.2.1, 1.4.4
- **見積もり**: 1時間

---

### 2.3 UI強化

#### 2.3.1 ステータスアイコン
- [ ] メニューバーアイコンを設計/作成する:
  - Idle（灰色）
  - Monitoring（緑色）
  - Correcting（青色）
  - Unsupported（オレンジ色）
  - Error（赤色）
  - Paused（黄色）
- [ ] 状態に基づくアイコン切り替えを統合する
- **完了条件**: アイコンが現在の状態を反映する
- **依存関係**: 1.5.2
- **見積もり**: 1.5時間

#### 2.3.2 音量の可視化
- [ ] メニューに視覚的な音量インジケーターを追加する
  - 小さなプログレスバーまたはリング
  - 現在と目標を表示
- [ ] リアルタイムで更新する
- **完了条件**: ユーザーが音量を一目で確認できる
- **依存関係**: 1.5.4
- **見積もり**: 1時間

#### 2.3.3 補正履歴表示
- [ ] RuntimeStatusで最近の数回の補正を追跡する
- [ ] メニューに「最後の補正: X分前」を表示する
- [ ] 「今回のセッションの補正回数: N」を表示する
- **完了条件**: ユーザーが補正アクティビティを確認できる
- **依存関係**: 1.4.4, 1.5.2
- **見積もり**: 45分

#### 2.3.4 設定の改善
- [ ] すべての設定にツールチップ/ヘルプテキストを追加する
- [ ] 推奨値を明確に表示する
- [ ] 「デフォルトにリセット」ボタンを追加する
- [ ] 保存前に設定を検証する（極端な値の警告を表示）
- **完了条件**: 設定が自明である
- **依存関係**: 1.5.6
- **見積もり**: 1時間

---

### 2.4 パフォーマンスと信頼性

#### 2.4.1 メモリリークテスト
- [ ] Instrumentsでリークを実行する
- [ ] 以下での適切なクリーンアップを検証する:
  - 有効/無効サイクル
  - 設定変更
  - デバイス変更
  - アプリ終了
- [ ] 発見されたリークを修正する
- **完了条件**: メモリリークが検出されない
- **依存関係**: Phase 1完了
- **見積もり**: 1.5時間

#### 2.4.2 CPU使用率の最適化
- [ ] 監視中のCPU使用率をプロファイリングする
- [ ] ポーリング間隔のデフォルトを最適化する
- [ ] アイドル時のCPU使用率が最小限であることを保証する
- [ ] 目標: アイドル時<1%、監視時<2%
- **完了条件**: CPU使用率が目標内
- **依存関係**: Phase 1完了
- **見積もり**: 1時間

#### 2.4.3 イベントリスナーの信頼性
- [ ] 見逃されたイベントをテストする
- [ ] PollingGuardが見逃された変更をキャッチすることを検証する
- [ ] イベント対ポーリング検出のロギングを追加する
- [ ] 発見に基づいてデフォルトポーリング間隔を調整する
- **完了条件**: 監視が信頼性が高い
- **依存関係**: 1.2.6, 1.2.8
- **見積もり**: 1時間

---

### 2.5 テストと検証

#### 2.5.1 自動UIテスト
- [ ] 以下のUIテストを追加する:
  - アプリを起動
  - ロック有効/無効
  - 設定変更
  - UI更新の検証
- **完了条件**: 基本的なUIフローが自動化されている
- **依存関係**: 1.6.2
- **見積もり**: 2時間

#### 2.5.2 統合テスト
- [ ] 以下のテストを追加する:
  - 完全な監視サイクル
  - エラー回復
  - 設定永続化
  - 一時停止/再開
- **完了条件**: 主要な統合シナリオがテストされている
- **依存関係**: 2.2.3
- **見積もり**: 2時間

#### 2.5.3 ベータテスト準備
- [ ] テストシナリオドキュメントを作成する
- [ ] フィードバック収集方法を準備する
- [ ] クラッシュログ収集手順を作成する
- **完了条件**: ベータテスターの準備完了
- **依存関係**: Phase 2のすべてのタスク
- **見積もり**: 1時間

---

## Phase 3: 配布品質（1-2日）

### 3.1 コード署名と公正証明

#### 3.1.1 デベロッパーIDのセットアップ
- [ ] AppleデベロッパーID証明書を取得する
- [ ] Xcodeプロジェクト設定で署名を設定する
- [ ] 署名付きローカルビルドをテストする
- **完了条件**: 有効な署名でアプリがビルドされる
- **依存関係**: Phase 2完了
- **見積もり**: 1時間

#### 3.1.2 公正証明のセットアップ
- [ ] 公正証明ワークフローを設定する
- [ ] 公正証明スクリプトを作成する（xcrun notarytool）
- [ ] ビルドで公正証明をテストする
- [ ] 公正証明されたアプリが警告なしで実行されることを検証する
- **完了条件**: アプリが公正証明されている
- **依存関係**: 3.1.1
- **見積もり**: 1.5時間

#### 3.1.3 自動ビルドスクリプト
- [ ] ビルドスクリプトを作成する:
  - ビルドフォルダをクリーン
  - アプリをアーカイブ
  - アプリに署名
  - アプリを公正証明
  - チケットをステープル
  - 配布可能なDMGまたはZIPを作成
- **完了条件**: ワンコマンドリリースビルド
- **依存関係**: 3.1.2
- **見積もり**: 1.5時間

---

### 3.2 初回実行体験

#### 3.2.1 ウェルカム画面
- [ ] ウェルカム/オンボーディングビューを作成する
- [ ] アプリの簡単な説明を表示する
- [ ] 基本セットアップ手順を表示する:
  - ロック有効化
  - 目標音量調整
  - （オプション）ログイン時起動有効化
- [ ] 「了解、ありがとう」ボタンを追加する
- **完了条件**: 初回ユーザーがアプリを理解する
- **依存関係**: 1.5.1
- **見積もり**: 2時間

#### 3.2.2 権限ガイド
- [ ] 必要な権限を説明するヘルプセクションを追加する
- [ ] 必要に応じてシステム設定にリンクする
- [ ] トラブルシューティング手順を提供する
- **完了条件**: ユーザーが権限問題を解決できる
- **依存関係**: 3.2.1
- **見積もり**: 1.5時間

#### 3.2.3 クイックスタートガイド
- [ ] シンプルなアプリ内ガイドを作成する:
  - 「MicLockとは？」
  - 「使い方は？」
  - 「音量が変わるのはなぜ？」
  - よくある質問
- **完了条件**: ユーザーが答えを見つけられる
- **依存関係**: 3.2.1
- **見積もり**: 1.5時間

---

### 3.3 ドキュメント

#### 3.3.1 README.md
- [ ] プロジェクトREADMEを作成する:
  - MicLockとは？
  - 機能
  - 動作環境
  - インストール手順
  - 基本的な使い方
  - トラブルシューティング
  - クレジット/ライセンス
- **完了条件**: プロフェッショナルなREADME
- **依存関係**: なし
- **見積もり**: 1時間

#### 3.3.2 リリースノートテンプレート
- [ ] リリースノートテンプレートを作成する:
  - バージョン番号
  - 新機能
  - バグ修正
  - 既知の問題
  - アップグレード手順
- [ ] 初回v1.0リリースノートを追加する
- **完了条件**: リリースの準備完了
- **依存関係**: なし
- **見積もり**: 30分

#### 3.3.3 アーキテクチャドキュメント
- [ ] Clean Architecture実装を文書化する
- [ ] コンポーネント相互作用図を作成する
- [ ] 複雑なロジックのコードコメントを追加する
- **完了条件**: 将来のメンテナーがコードを理解できる
- **依存関係**: なし
- **見積もり**: 1.5時間

---

### 3.4 最終仕上げ

#### 3.4.1 アプリアイコンデザイン
- [ ] アプリアイコンを設計/依頼する
- [ ] 必要なすべてのサイズを作成する:
  - 16x16（メニューバー）
  - 32x32（メニューバー@2x）
  - 128x128、256x256、512x512、1024x1024（アプリアイコン）
- [ ] Xcodeアセットカタログに追加する
- **完了条件**: プロフェッショナルなアプリアイコン
- **依存関係**: なし
- **見積もり**: 2時間

#### 3.4.2 UIの仕上げ
- [ ] 一貫性のためにすべてのUI要素を見直す
- [ ] 状態変更の微細なアニメーションを追加する
- [ ] 適切な間隔と配置を保証する
- [ ] 異なる表示スケールでテストする
- **完了条件**: 洗練されたUI
- **依存関係**: Phase 2完了
- **見積もり**: 1.5時間

#### 3.4.3 アクセシビリティ
- [ ] すべてのインタラクティブ要素にVoiceOverラベルを追加する
- [ ] キーボードナビゲーションが動作することを保証する
- [ ] VoiceOver有効でテストする
- [ ] アクセシビリティ識別子を追加する
- **完了条件**: アプリがアクセシビリティ対応
- **依存関係**: Phase 2完了
- **見積もり**: 1.5時間

#### 3.4.4 ローカライゼーション準備
- [ ] すべてのユーザー向け文字列をLocalizable.stringsに抽出する
- [ ] コンテキスト別に文字列を整理する
- [ ] 日本語翻訳のプレースホルダーを追加する
- [ ] 翻訳プロセスを文書化する
- **完了条件**: ローカライゼーションの準備完了
- **依存関係**: すべてのUI完了
- **見積もり**: 1時間

---

### 3.5 配布

#### 3.5.1 配布チャネルのセットアップ
- [ ] 配布方法を決定する（GitHubリリース、直接ダウンロードなど）
- [ ] ホスティング場所を準備する
- [ ] バージョニング方式を設定する（セマンティックバージョニング）
- **完了条件**: 明確な配布計画
- **依存関係**: 3.1.3
- **見積もり**: 30分

#### 3.5.2 ウェブサイト/ランディングページ（オプション）
- [ ] シンプルなランディングページを作成する:
  - アプリ説明
  - ダウンロードリンク
  - スクリーンショット
  - 機能
  - 連絡先情報
- **完了条件**: ユーザーがアプリを見つけてダウンロードできる
- **依存関係**: なし
- **見積もり**: 2時間（オプション）

#### 3.5.3 最終テスト
- [ ] クリーンなmacOSで新規インストールをテストする
- [ ] 以前のバージョンからのアップグレードをテストする
- [ ] 複数のmacOSバージョンでテストする（最小ターゲットから最新まで）
- [ ] コンソールエラーまたは警告がないことを検証する
- **完了条件**: リリース準備完了
- **依存関係**: Phase 3のすべてのタスク
- **見積もり**: 2時間

---

## リリース後（将来の機能拡張）

### 将来の機能の可能性
- [ ] 音量履歴グラフ
- [ ] 複数デバイスプロファイル
- [ ] 自動デバイス切り替え
- [ ] AppleScriptサポート
- [ ] 統計ダッシュボード
- [ ] デバイスごとのカスタムイプシロン
- [ ] 通知センター統合
- [ ] iMessage/Teams/Zoom固有プロファイル

---

## まとめ

| Phase | タスク数 | 見積もり時間 |
|-------|---------|-------------|
| Phase 1: MVP基盤構築 | 32 | 2-4日 |
| Phase 2: 運用強化 | 19 | 2-3日 |
| Phase 3: 配布品質 | 17 | 1-2日 |
| **合計** | **68** | **5-9日** |

**注意**: 時間の見積もりは、Swift、SwiftUI、macOS開発に精通していることを前提としています。実際の時間は経験と予期せぬ課題によって異なる場合があります。
